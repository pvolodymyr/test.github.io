(()=>{"use strict";const e="radio button",t="https://searchwidget-ezt.pages.dev/data_makes.json",i="https://searchwidget-ezt.pages.dev/states_of_USA.json",s={QA:"QA",UAT:"UAT",PROD:"PROD"},n={QA:"https://chaiz-api-qa.azurewebsites.net",UAT:"https://chaiz-api-uat.azurewebsites.net",PROD:"https://chaiz-api.azurewebsites.net"},a="chaizEnvironment",l=()=>String(Date.now().toString(32)+Math.random().toString(16)).replace(/\./g,""),o=(e="")=>{const t=(()=>{const e=L();return n[e]})();return fetch(`${t}/VehicleDetails/DecodeVin?vin=${e}`)};const r=e=>e&&"function"==typeof e,h={numbersOnly:(e,t)=>{const i=e.trimStart(),s=t.trimStart();if(""===s)return s;const n=parseInt(s);return isNaN(n)||n<0||!/^\d+$/.test(s)?i:s},lettersOnly:(e,t)=>{const i=e.trimStart(),s=t.trimStart();return""===s||/^[a-zA-Z ]+$/.test(s)?s:i},lettersAndNumbers:(e,t)=>{const i=e.trimStart(),s=t.trimStart();return""===s||/^[a-zA-Z0-9]+$/.test(s)?s:i},carModelCharacters:(e,t)=>{const i=e.trimStart(),s=t.trimStart();return""===s||/^[a-zA-Z0-9\-_ ./&]+$/.test(s)?s:i}},d=(e="")=>e.trim().toLowerCase(),u=(e,t)=>{const i=t.filter((({name:t})=>d(t).startsWith(d(e))));if(1===i.length)return i[0];return i.find((({name:t})=>d(t)===d(e)))},c={modelYear:(e,t)=>{if(e.length>=2)return t.find((({name:t})=>t.endsWith(e)))},state:(e,t)=>{if(e.length>=2){const i=((e,t)=>t.find((({value:t})=>d(t)===d(e))))(e,t);return i||u(e,t)}},makeModel:(e,t)=>e?u(e,t):""},m=(e=["includes"])=>(t="",i=[],s=[])=>i.filter((i=>e.some((e=>s.some((s=>i[s].toLowerCase()[e](t.toLowerCase()))))))),p={startsWidth:m(["startsWith"]),endsWidth:m(["endsWith"]),startsOrEndsWidth:m(["startsWith","endsWith"])},E="empty",g="invalid",b="incomplete",v="valid",f=(e="")=>e.replace(/\s/g,""),S=e=>{if(!e)return!1;if(17!==(e=e.trim().toUpperCase()).length)return!1;let t=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2],i=0;for(let s=0;s<17;s++){let n=e[s];if(!/[a-zA-Z0-9]/.test(n))return!1;if(!(n in y))return!1;i+=y[n]*t[s]}let s=i%11;return 10===s?"X"===e[8]:s===parseInt(e[8])},y={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9},F={matchOptionNameProp:(e="",t=[])=>e.trim()?t.find((e=>({name:t})=>d(t)===d(e))(e))?v:g:E,mileage:(e="")=>e.trim()?e>=0&&e<=999999?v:g:E,licensePlate:(e="")=>{const t=f(e);return t?t.length<2?b:v:E},vin:(e="")=>{const t=f(e);return t?t.length<17?b:S(e)?v:g:E}},L=()=>window[a]in s?window[a]:s.QA,w="We couldn't find a car matching your license plate. Please check for errors or search with your make and model.",k="Something went wrong, please try again or search via make and model",D=(e="")=>"no result found"===e.toLowerCase()?w:k,I="license_plate_form",V="manufacturer_form",C="vin_form",O="extended",B="compact",A=(e,t)=>{if(!e||0===e.length)return"";const i=e[0].validationState;if(!e.every((({validationState:e})=>e===i))&&1!==e.length)return(e=>{const t={};e.forEach((({fieldName:e,validationState:i})=>{t[i]||(t[i]=[]),t[i].push(e)}));const i=Object.entries(t);i.sort(((e,t)=>t[1].length-e[1].length));const s=i[0][1].length>1?"Fields":"Field";return i.reduce(((e,[t,s],n)=>{const a=i[n][1].length>1?"are":"is",l=s.join(", "),o=((e,t)=>{const i=e.length-1===t,s=e.length-2===t;return i?"":s?" and":","})(i,n);return`${e} ${l} ${a} ${t}${o}`}),s)})(e);switch(e.length){case 1:return`Field ${e[0].fieldName} is ${i}`;case 2:return`Fields ${e[0].fieldName} and ${e[1].fieldName} are ${i}`;case t:return`All fields are ${i}`;default:return(e=>e.reduce(((t,{fieldName:i},s)=>t+(i+((e,t)=>{const i=e[0].validationState,s=e.length-1===t,n=e.length-2===t;return s?` are ${i}`:n?" and ":", "})(e,s))),"Fields "))(e)}},M="licensePlate",H="make",P="model",T="year",N="state",_="mileage",W="vin",R={licensePlateForm:["licensePlateInput","stateInput","mileageInput"],makeModelForm:["makeInput","modelInput","modelYearInput","stateInput","mileageInput"],vinForm:["vinInput","stateInput","mileageInput"]},x={Row:"row",Column:"column"};const z=class{#e;#t;#i;#s;constructor({hostElementId:e="",selectHandler:t=(()=>{}),layoutType:i=x.Row,selectedOption:s="makeModelForm"}){this.#e=document.getElementById(e),this.#t=t,this.#i=i,this.#n(),this.#t(s)}#n(){Array.from(this.#e.querySelectorAll("label")).forEach((e=>e.addEventListener("click",this.#a.bind(this)))),this.#e.addEventListener("keydown",this.#l.bind(this))}#o(t){return t.closest(`[aria-label="${e}"]`)}#r(e){const t=this.#o(document.activeElement);"forward"===e&&t.nextElementSibling&&this.#h(t.nextElementSibling),"back"===e&&t.previousElementSibling&&this.#h(t.previousElementSibling)}#h(e){if(this.#s)return;const t=e.querySelector('input[type="radio"]')?.id;this.setSelectedOption(t)}#a(e){e.preventDefault(),e.stopPropagation();const t=this.#o(e.target);t&&this.#h(t)}#l(e){switch(e?.key){case"ArrowUp":return void(this.#i===x.Column&&this.#r("back"));case"ArrowLeft":return void(this.#i===x.Row&&this.#r("back"));case"ArrowDown":return void(this.#i===x.Column&&this.#r("forward"));case"ArrowRight":return void(this.#i===x.Row&&this.#r("forward"))}}setSelectedOption=t=>{this.#t(t);Array.from(this.#e.querySelectorAll(`[aria-label="${e}"]`)).forEach((e=>{const i=e.querySelector('input[type="radio"]'),s=e.querySelector("label");i.id===t?(s.tabIndex=0,i.checked=!0,i["aria-checked"]=!0,s.focus()):(s.tabIndex=-1,i["aria-checked"]=!1,i.checked=!1)}))};setLayoutType(e){e&&x.keys.some(e)&&(this.#i=e)}setDisabled=e=>{this.#s=e,this.#e.querySelectorAll("input[type=radio]").forEach((t=>{e?t.setAttribute("disabled",!0):t.removeAttribute("disabled")}))}},$=(e,t)=>e.name>t.name?1:-1,U=(e,t)=>e.name>t.name?-1:1,q=(e,t="ASCENDING")=>e.map((({name:e,value:t},i)=>({name:e.toString(),value:t.toString(),index:i}))).sort("ASCENDING"===t?$:U);const j=class{hasError=!1;isActive=!1;isValid=!1;validationState=E;constructor({hostElementId:e="",inputElementId:t="",initialValue:i="",name:s="",valueRestrictionsHandler:n=((e,t)=>t),isDisabled:a=!1,validationHandler:l=(()=>"valid"),onChangeHandler:o=(()=>{})}){this.hostElement=document.getElementById(e),this.inputElement=this.hostElement.querySelector(`#${t}`),this.value=i,this.name=s,this.handleValueRestrictions=n,this.isDisabled=a,this.isValid=!!i,this.validationState=i?v:E,this.validationHandler=l,this.onChangeHandler=o,i&&this.hostElement.classList.add("valid")}onInput=e=>{const t=this.handleValueRestrictions(this._value,e.target.value);t!==this._value&&(this.hasError&&this.setErrorState(!1),this.onChangeHandler()),this.value=t};setDisabled=e=>{this.isDisabled=e,e?this.inputElement.setAttribute("disabled",!0):this.inputElement.removeAttribute("disabled")};setErrorState=e=>{this.hasError=e,this.hostElement.classList.toggle("error",e)};setActiveState=e=>{this.isActive=e,this.hostElement.classList.toggle("isActive",e)};setValidationState=e=>{this.isValid=e===v,this.validationState=e,this.hostElement.classList.toggle("valid",this.isValid)};handleValidation=(...e)=>{this.setValidationState(this.validationHandler(...e))};get value(){return this._value}set value(e=""){this.inputElement.value=e,this._value=e,""===this.value&&this.hostElement.classList.remove("valid")}},G={DOWN:"down",UP:"up"};function Y(e,t=G.DOWN){return e?e.hasAttribute("hidden")?Y(t===G.DOWN?e.nextElementSibling:e.previousElementSibling,t):e:null}const K=class{#d=null;#u=null;#e=null;#c=[];#m="";#p=!1;#t=()=>{};#E;constructor({hostElementId:e="",options:t=[],ariaLabel:i="",selectHandler:s,name:n=""}){this.#e=document.getElementById(e),this.#c=t,this.#m=i,this.#E=n,r(s)&&(this.#t=s),this.#g(),this.#n(),this.#e.appendChild(this.#d)}#b=({name:e,value:t,index:i})=>{const s=document.createElement("li");return s.tabIndex=-1,s.dataset.value=t,s.dataset.name=e,s.dataset.index=i,s.textContent=e,s.role="option",s};#v(e=[]){return e.map(this.#b)}#f(e){this.#u.replaceChildren(...this.#v(e))}#S(){this.#u=document.createElement("ul"),this.#u.role="listbox",this.#u.setAttribute("aria-label",this.#m),this.#f(this.#c)}#g(){this.#S(),this.#d=document.createElement("div"),this.#d.classList.add("options_list"),this.#d.appendChild(this.#u)}#y(e){if(this.#p)return;const t=document.activeElement||this.#u.children[0];if(e===G.DOWN){const e=Y(t.nextElementSibling,G.DOWN)||Y(this.#u.children[0],G.DOWN);e&&e.focus()}if(e===G.UP){const e=Y(t.previousElementSibling,G.UP)||Y(this.#u.children[this.#u.children.length-1],G.UP);e&&e.focus()}}#l(e){switch(e.key){case"Tab":e.shiftKey||(e.stopPropagation(),e.preventDefault(),this.#F(e.target));break;case"Enter":e.stopPropagation(),e.preventDefault(),this.#F(e.target);break;case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.#y(G.DOWN);break;case"ArrowUp":e.preventDefault(),this.#y(G.UP)}}#n(){this.#u.addEventListener("keydown",this.#l.bind(this)),this.#u.addEventListener("click",this.#L.bind(this))}#F(e){const t=(i=e)&&"LI"===i.nodeName?i.dataset:null;var i;t&&t.name&&(this.#t(t.name),this.setSelectedOption(t.name))}#L(e){e.stopPropagation(),this.#F(e.target)}updateOptions(e=[]){e.length>0&&(this.#c=e),this.#f(this.#c)}#w=()=>{const e=document.createElement("li");return e.classList.add("empty_list_error_message"),e.textContent=`${this.#E} not found`,e.setAttribute("aria-label","not found error message"),e};#k=()=>{if(this.#p)this.#u.replaceChildren(this.#w());else{const e=this.#u.querySelector(".empty_list_error_message");e&&e.remove()}};setVisibleOptions(e=[]){0===e.length?this.#p||(this.#p=!0,this.#k()):(this.#p&&(this.#p=!1,this.#k()),this.#f(e))}getVisibleOptions=()=>this.#p?[]:((e=[])=>e.map((e=>e&&e.dataset&&e.dataset.name?{name:e.dataset.name,value:e.dataset.value||""}:null)).filter(Boolean))(Array.from(this.#u.children));#D=()=>{const e=this.#u.querySelector(".csw-selected-option");e&&e.classList.remove("csw-selected-option")};setSelectedOption=e=>{this.#D();const t=this.#u.querySelector(`[data-name="${e}"]`);t&&t.classList.add("csw-selected-option")};focus(){if(this.#p)return;const e=Y(this.#u.children[0],G.DOWN);e&&e.focus()}};const Z=class{inputField=null;backButton=null;constructor(e="",t=20){this.createFilterBar(e,t)}produceBackButton=()=>{const e=document.createElement("button");return e.classList.add("combobox_filter_bar_back_button"),e.ariaLabel="close combobox",this.backButton=e,e};produceFilterInput=(e,t)=>{const i=document.createElement("input");return i.type="text",i.id=l(),i.classList.add("combobox_filter_bar_filter_input"),i.placeholder=e,i.maxLength=t,this.inputField=i,i};produceWrapper=()=>{const e=document.createElement("div");return e.classList.add("combobox_filter_bar"),e};createFilterBar=(e,t)=>{const i=this.produceWrapper();i.appendChild(this.produceBackButton()),i.appendChild(this.produceFilterInput(e,t)),this.element=i};unmount=()=>{this.element.remove()}};const Q=class{element=null;constructor(){this.#I()}#I=()=>{const e=document.createElement("div");e.classList.add("combobox_close_layer"),this.element=e};unmount=()=>{this.element.remove()}};const J=class extends j{#c=[];#V=null;#C=null;#O=null;#B=l();#A=!1;#M=!1;#H=null;#P="";#T;#N;#_;#W;#R;#t;#x="";selectedValue="";#z=20;#$;#U;constructor({hostElementId:e="",inputElementId:t="",options:i=[],isMobileView:s=!1,filterInputPlaceholder:n="",isDisabled:a=!1,valueRestrictionsHandler:l=((e,t)=>t),name:o="",searchBy:r=["name"],sortingType:h="ASCENDING",initialValue:d="",validationHandler:u,selectHandler:c=(()=>{}),autocompleteStrategy:m=(()=>!1),handleFilterVisibleOptions:p=(()=>[]),onFocus:E=(()=>{}),onBlur:g=(()=>{}),onChangeHandler:b,maxLength:v=20}){super({hostElementId:e,inputElementId:t,initialValue:d,name:o,valueRestrictionsHandler:l,isDisabled:a,validationHandler:u,onChangeHandler:b}),this.#R=e,this.#M=s,this.#c=q(i,h),this.#P=n,this.#T=r,this.#N=h,this.#_=m,this.#W=p,this.#t=c,this.#$=E,this.#U=g,this.#z=v,t&&this.hostElement&&(this.inputElement=this.hostElement.querySelector(`#${t}`)),this.#g(),this.#V=new K({hostElementId:this.#B,options:this.#c,selectHandler:this.#q,name:o}),d&&(this.selectedValue=d,this.setSelectedOptionName(d),this.hostElement.classList.add("valid")),this.#n()}#h=e=>{this.setValue(e),this.handleClose()};#q=e=>{this.inputElement.focus(),this.#h(e)};#j=()=>{let e=null;const t=this.#V.getVisibleOptions();e=1===t.length?t[0]:this.#_(this._value,this.#c),e&&this.selectedValue!==this.value&&(this.#h(e.name),this.setSelectedOptionName(e.name))};#G=e=>{e.preventDefault(),e.stopPropagation(),this.#M&&this.#C.inputField.value!==this.inputElement.value&&(this.#C.inputField.value=this.inputElement.value,this._value=this.inputElement.value),this.handleClose()};#Y=e=>{const t=this.value;this.onInput(e),this.#x=e.target.value,t!==this.value&&(this.onChangeHandler(this.value),!this.#A&&this.handleOpen()),this.#K(this.#x)};#Z=()=>{setTimeout((()=>{this.#A||(this.#j(),this.validate(),document.activeElement!==this.inputElement&&this.#Q())}),150)};#J=e=>{const t=this.handleValueRestrictions(this.#x,e.target.value);this.#C.inputField.value=t,this.#K(t)};#X=e=>{if("ArrowDown"===e.key)return e.preventDefault(),this.handleOpen(),void this.#V.focus()};#ee=e=>{switch(e.key){case"Tab":this.handleClose();break;case"Escape":e.preventDefault(),this.#A?(this.handleClose(),this.inputElement.focus()):""!==this._value&&(this._value="",this.#V.setVisibleOptions(this.#c),this.inputElement.value="",this.#t&&this.#t(""))}};#te=()=>{this.#$(),this.setActiveState(!0)};#Q=()=>{this.#U(),this.setActiveState(!1)};#ie=()=>{this.#M?(this.#O=new Q,this.#C=new Z(this.#P,this.#z),this.inputElement.setAttribute("readonly",this.#M),this.#H.prepend(this.#C.element),this.hostElement.appendChild(this.#O.element),this.#C.inputField.addEventListener("input",this.#J),this.#C.inputField.value=this._value,this.#C.backButton.addEventListener("click",this.#G),this.#O.element.addEventListener("click",this.#G)):(this.#C.unmount(),this.#O.unmount(),this.inputElement.removeAttribute("readonly"),this.inputElement.addEventListener("focus",this.#te),this.inputElement.addEventListener("blur",this.#Z),this.inputElement.addEventListener("keydown",this.#X))};#se=()=>{const e=window.innerWidth<1024;e!==this.#M&&(this.#M=e,this.#ie())};#g=()=>{this.#O=new Q,this.#H=document.createElement("div"),this.#H.id=this.#B,this.#H.className="combobox_wrapper",this.#M&&(this.#C=new Z(this.#P,this.#z),this.#H.appendChild(this.#C.element),this.hostElement.appendChild(this.#O.element)),this.hostElement.appendChild(this.#H)};#ne=()=>{this.hostElement.addEventListener("click",this.handleOpen),this.hostElement.addEventListener("keydown",this.#ee),this.inputElement.addEventListener("focus",this.#te),this.inputElement.addEventListener("input",this.#Y),this.inputElement.addEventListener("blur",this.#Z),this.inputElement.addEventListener("keydown",this.#X),this.#M&&(this.#C.inputField.addEventListener("input",this.#J),this.#C.backButton.addEventListener("click",this.#G),this.#O.element.addEventListener("click",this.#G)),window.addEventListener("resize",((e,t)=>{let i=null;return(...s)=>{window.clearTimeout(i),i=window.setTimeout((()=>{e.apply(null,s)}),t)}})(this.#se,100)),document.addEventListener("click",(e=>{e.target.closest(`#${this.#R}`)||(this.handleClose(),this.isActive&&this.#Z())}))};#n=()=>{this.#ne(),this.hostElement.classList.add("closed"),this.hostElement.classList.add("combobox"),this.#M&&this.inputElement.setAttribute("readonly",!0),this.isDisabled&&this.inputElement.setAttribute("disabled",!0)};#K=e=>{this.#V.setVisibleOptions(this.#W(e,this.#c,this.#T))};updateOptions=e=>{this.value="",this.selectedValue="",this.#c=q(e,this.#N),this.#V.updateOptions(this.#c)};handleOpen=()=>{this.isDisabled||(this.#A=!0,this.hostElement.classList.remove("closed"),this.hostElement.classList.add("open"),this.#te())};handleClose=()=>{this.#A=!1,this.hostElement.classList.remove("open"),this.hostElement.classList.add("closed")};validate=()=>{this.handleValidation(this._value,this.#c),this.isValid||(this.value="",this.#x="",this.#V.updateOptions([]))};setValue=(e="")=>{this.value=e,this.selectedValue=e,this.#x="",this.#K(this.#x),this.#M&&(this.#C.inputField.value=e),this.setErrorState(!1),this.setValidationState(!0),this.setSelectedOptionName(e),this.#t(e),this.onChangeHandler()};setSelectedOptionName=e=>{e&&(this.#V.setSelectedOption(e),this.hostElement.classList.add("valid"))};resetFilter=()=>{this.#x="",this.#M&&(this.#C.inputField.value="")};focus=()=>{this.handleOpen(),this.inputElement.focus()}};const X=class{#ae=null;#le=null;constructor({hostElementId:e="",submitHandler:t}){this.#ae=document.getElementById(e),this.#le=r(t)?t:()=>{},this.#ae&&this.#oe()}setDisabled(e){e?this.#ae.setAttribute("disabled",!0):this.#ae.removeAttribute("disabled")}setLoading(e){this.#ae.classList.toggle("loading",e)}#a(e){e.preventDefault(),this.#le()}#oe(){this.#ae.addEventListener("click",this.#a.bind(this))}};const ee=class extends j{hasError=!1;#$;#U;constructor({hostElementId:e="",inputElementId:t="",initialValue:i="",name:s="",valueRestrictionsHandler:n=((e,t)=>t),validationHandler:a=(()=>!0),isDisabled:l=!1,onChangeHandler:o,onFocus:r=(()=>{}),onBlur:h=(()=>{})}){super({hostElementId:e,inputElementId:t,initialValue:i,name:s,valueRestrictionsHandler:n,isDisabled:l,validationHandler:a,onChangeHandler:o}),this.#$=r,this.#U=h,this.hostElement&&this.#oe()}validate=()=>{this.handleValidation(this._value)};setValue=(e="")=>{e&&(this.value=e,this.setErrorState(!1),this.setValidationState(!0))};#te=()=>{this.#$(),this.setActiveState(!0)};#Z=()=>{this.validate(),this.#U(),this.setActiveState(!1)};#oe=()=>{this.isDisabled&&this.setDisabled(!0),this.inputElement.addEventListener("focus",this.#te),this.inputElement.addEventListener("input",this.onInput),this.inputElement.addEventListener("blur",this.#Z)}},te={formType:"makeModelForm",licensePlate:"",make:"",model:"",year:"",mileage:"",state:""},ie="licensePlateField",se="mileageField",ne="stateField",ae="makeField",le="modelField",oe="modelYearField",re="vinField",he="licensePlateInput",de="mileageInput",ue="stateInput",ce="makeInput",me="modelInput",pe="modelYearInput",Ee="vinInput";const ge=class{root=null;hasError=!1;errorMessage="";#re;#he;#de="makeModelForm";#M;#ue;#ce=null;licensePlateInput=null;makeInput=null;modelInput=null;modelYearInput=null;stateInput=null;mileageInput=null;#me=null;#pe=!1;focusedFields=new Set;constructor({hostId:e="searchWidget",widgetType:t=O,desktopStartBreakpoint:i=1024,onLicensePlateError:s=(()=>{}),onVinError:n=(()=>{}),onEmptyFieldsError:a=(()=>{}),onSubmit:l=(()=>{}),initialData:o=te,carsData:r={},statesData:h=[],yearsData:d=[],makesData:u=[],modelData:c=[]}){this.#he=document.getElementById(e),this.#re=t,this.#M=window.innerWidth<i,this.onLicensePlateError=s,this.onVinError=n,this.onEmptyFieldsError=a,this.onSubmit=l,this.initialData=o,this.carsData=r,this.statesData=h,this.yearsData=d,this.modelData=c,this.makesData=u,this.#oe()}#Ee=e=>R[e].map((e=>this[e]));#ge=e=>{this.#me.setDisabled(e),this.#ce.setDisabled(e),this.#Ee(this.#de).forEach((t=>{t.setDisabled(e)}))};setFormLoadingStatus=(e=!1)=>{this.#ge(e),this.#pe=e,this.#me.setLoading(e),this.#he.classList.toggle("isLoading",e)};#be=e=>{this.onEmptyFieldsError(e)};#ve=()=>{this.#be(""),this.hasError=!1,this.#me.setDisabled(!1)};#fe=e=>{this.#Ee(e).map((e=>e&&e.setErrorState(!1)))};#Se=()=>{this.errorMessage="",this.#be("");const e=this.#Ee(this.#de).every((e=>!e.hasError));this.#pe||this.#me.setDisabled(!e)};#ye=e=>{""===e&&(this.#ue="",this.modelInput.value="",this.modelInput.selectedValue="",this.modelInput.updateOptions([]),this.modelInput.setDisabled(!0)),this.#Se()};#Fe=()=>{const e=[];this.#Ee(this.#de).forEach((t=>{t.validate(),t.isValid&&t.value||(t.setErrorState(!0),e.push(t))})),this.hasError=e.length>0,this.hasError&&(this.errorMessage=A(e.map((e=>({fieldName:e.name,validationState:e.validationState}))),this.#Ee(this.#de).length))};#Le=()=>{const e=this.#we();!e.licencePlate||e.licencePlate.length<2||!e.shortStateValue||((e,t)=>{const i={plate:e,state:t};return fetch("https://platetovin.net/api/convert",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",authorization:"5ICpITb9gAI9Yiv"},body:JSON.stringify(i)})})(e.licencePlate,e.shortStateValue).then((e=>e.json())).then((t=>{if(t.success){this.#re===B&&this.setFormLoadingStatus(!1);const e=this.#we(),{vin:i,year:s,make:n,model:a}=t.vin||{};this.onSubmit({...e,vin:i,year:s,make:n,model:a})}else this.hasError=!0,this.setFormLoadingStatus(!1),this.onLicensePlateError({errorMessage:D(t.message),licensePlate:e.licencePlate,state:e.state,odometer:e.searchMileage})})).catch(((t={message:""})=>{this.hasError=!0,this.setFormLoadingStatus(!1),this.onLicensePlateError({errorMessage:D(t.message),licensePlate:e.licencePlate,state:e.state,odometer:e.mileage})}))};#ke=()=>{const e=this.#we();!e.vin||e.vin.length<17||!S(e.vin)||o(e.vin,e.shortStateValue).then((e=>e.json())).then((({response:t,errorResponse:i}={})=>{if(i)this.hasError=!0,this.setFormLoadingStatus(!1),this.onVinError({errorMessage:"Invalid vin number",vin:e.vin,state:e.state,odometer:e.searchMileage});else{this.#re===B&&this.setFormLoadingStatus(!1);const{vin:i,year:s,make:n,model:a}=t||{};this.onSubmit({...e,vin:i,year:s,make:n,model:a})}})).catch((()=>{this.hasError=!0,this.setFormLoadingStatus(!1),this.onVinError({errorMessage:"Invalid vin number",vin:e.vin,state:e.state,odometer:e.mileage})}))};#we=()=>((e,t)=>{const i={};return e.forEach((e=>{const{name:s,value:n}=e;switch(s){case W:i.vin=n;break;case M:i.licencePlate=n;break;case _:i.searchMileage=n;break;case H:i.make=n;break;case P:i.model=n;break;case T:i.year=n;break;case N:i.shortStateValue=((e,t)=>{if(!e||!t)return"";const i=t.find((({name:t})=>t===e));return i&&i.value?i.value:""})(n,t),i.state=n}})),i})(this.#Ee(this.#de),this.statesData);#De=()=>{if(this.#Fe(),this.#pe=!0,this.#me.setDisabled(!0),this.hasError)return this.#be(this.errorMessage),void(this.#pe=!1);this.setFormLoadingStatus(!0),"licensePlateForm"===this.#de?this.#Le():"vinForm"===this.#de?this.#ke():(this.#re===B&&this.setFormLoadingStatus(!1),this.onSubmit(this.#we()))};#Ie=e=>{e&&e in this.carsData&&(this.modelData=this.carsData[e].models||[],this.modelInput.updateOptions(this.modelData),this.modelInput.setDisabled(!this.makesData||0===this.makesData.length))};#Ve=e=>{this.#ue!==e&&(this.#ue=e,this.#Ie(e),this.modelInput.resetFilter(),this.modelInput.focus())};#Ce(e){switch(e){case"licensePlateForm":this.#he.classList.remove(C),this.#he.classList.remove(V),this.#he.classList.add(I);break;case"makeModelForm":this.#he.classList.remove(C),this.#he.classList.remove(I),this.#he.classList.add(V);break;case"vinForm":this.#he.classList.remove(I),this.#he.classList.remove(V),this.#he.classList.add(C)}}#Oe(e=""){e in R&&(this.#de=e,this.#Ce(e),this.#ve(),this.#fe(this.#de))}setFormData=e=>{const{formType:t}=e;t&&this.#ce.setSelectedOption(t),this.#Ee(this.#de).forEach((t=>{e[t.name]&&t.setValue(e[t.name])}))};populateMakeModel=(e,t)=>{e&&(this.#ue=e,this.#Ie(e)),t&&(this.modelInput.value=t,this.modelInput.setSelectedOptionName(t))};setFocusState=(e,t)=>()=>{e?this.focusedFields.add(t):this.focusedFields.delete(t),this.#he.classList.toggle("focus_state",this.focusedFields.size>0)};#oe(){this.#me=new X({hostElementId:"formSubmitButton",submitHandler:this.#De}),this.#ce=new z({hostElementId:"searchWidgetRadioGroup",selectHandler:this.#Oe.bind(this),selectedOption:this.#de,layoutType:x.Row}),this.vinInput=new ee({name:W,hostElementId:re,inputElementId:Ee,validationHandler:F.vin,valueRestrictionsHandler:h.lettersAndNumbers,onChangeHandler:this.#Se,initialValue:this.initialData.vin||"",onFocus:this.setFocusState(!0,W),onBlur:this.setFocusState(!1,W)}),this.licensePlateInput=new ee({name:M,hostElementId:ie,inputElementId:he,validationHandler:F.licensePlate,valueRestrictionsHandler:h.lettersAndNumbers,onChangeHandler:this.#Se,initialValue:this.initialData.licensePlate||"",onFocus:this.setFocusState(!0,M),onBlur:this.setFocusState(!1,M)}),this.mileageInput=new ee({name:_,hostElementId:se,inputElementId:de,valueRestrictionsHandler:h.numbersOnly,validationHandler:F.mileage,onChangeHandler:this.#Se,initialValue:this.initialData.mileage||"",onFocus:this.setFocusState(!0,_),onBlur:this.setFocusState(!1,_)}),this.stateInput=new J({name:N,hostElementId:ne,inputElementId:ue,options:this.statesData,isMobileView:this.#M,valueRestrictionsHandler:h.lettersOnly,searchBy:["name","value"],autocompleteStrategy:c.state,handleFilterVisibleOptions:p.startsWidth,validationHandler:F.matchOptionNameProp,onChangeHandler:this.#Se,filterInputPlaceholder:"Select registration state",initialValue:this.initialData.state||"",onFocus:this.setFocusState(!0,N),onBlur:this.setFocusState(!1,N)}),this.makeInput=new J({name:H,hostElementId:ae,inputElementId:ce,options:this.makesData,isMobileView:this.#M,valueRestrictionsHandler:h.lettersOnly,selectHandler:this.#Ve,onChangeHandler:this.#ye,autocompleteStrategy:c.makeModel,handleFilterVisibleOptions:p.startsWidth,validationHandler:F.matchOptionNameProp,filterInputPlaceholder:"What car do you own?",initialValue:this.initialData.make||"",onFocus:this.setFocusState(!0,H),onBlur:this.setFocusState(!1,H)}),this.modelInput=new J({name:P,hostElementId:le,inputElementId:me,options:this.modelData,isMobileView:this.#M,valueRestrictionsHandler:h.carModelCharacters,validationHandler:F.matchOptionNameProp,autocompleteStrategy:c.makeModel,handleFilterVisibleOptions:p.startsWidth,onChangeHandler:this.#Se,isDisabled:!0,filterInputPlaceholder:"Add car model",initialValue:this.initialData.model||"",onFocus:this.setFocusState(!0,P),onBlur:this.setFocusState(!1,P)}),this.modelYearInput=new J({name:T,hostElementId:oe,inputElementId:pe,options:this.yearsData,isMobileView:this.#M,valueRestrictionsHandler:h.numbersOnly,sortingType:"DESCENDING",autocompleteStrategy:c.modelYear,handleFilterVisibleOptions:p.startsOrEndsWidth,validationHandler:F.matchOptionNameProp,onChangeHandler:this.#Se,filterInputPlaceholder:"Add year",initialValue:this.initialData.year||"",maxLength:4,onFocus:this.setFocusState(!0,T),onBlur:this.setFocusState(!1,T)}),this.#he.addEventListener("submit",(e=>{e.preventDefault(),this.#De()})),this.initialData.make&&populateMakeModel(this.initialData.make,this.initialData.model)}};window.SearchWidget=class{errorMessage="";constructor({initialData:e,onLicensePlateError:t=(()=>{}),onSubmit:i=(()=>{}),onClose:s=(()=>{})}){this.initialize({initialData:e,onLicensePlateError:t,onSubmit:i,onClose:s})}async initialize({initialData:e,onLicensePlateError:s,onSubmit:n,onClose:a}){const l=await async function(){return await fetch(t).then((e=>e.json())).catch((()=>[]))}(),o=await async function(){return await fetch(i).then((e=>e.json())).catch((()=>[]))}(),r=function(){const e=(new Date).getFullYear();return new Array(25).fill(null).map(((t,i)=>{const s=(e-i).toString();return{name:s,value:s}}))}(),h=((e={})=>Object.entries(e).map((([e,{id:t,name:i}])=>({name:i,value:t.toString()}))))(l);this.searchWidget=new ge({widgetType:B,onLicensePlateError:s,onSubmit:n,initialData:e,carsData:l,statesData:o,yearsData:r,makesData:h});const d=document.getElementById("csw-close-modal-layer"),u=document.getElementById("csw-close-modal-icon-button");u&&u.addEventListener("click",a),d&&d.addEventListener("click",a)}}})();